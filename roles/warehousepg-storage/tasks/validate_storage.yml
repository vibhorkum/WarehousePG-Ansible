---
# Validate storage space

- name: Get filesystem information for storage path
  shell: df -BG {{ storage_path | dirname }} | tail -1 | awk '{print $4}' | sed 's/G//'
  register: available_space
  changed_when: false
  failed_when: false

- name: Display available storage space
  debug:
    msg: "Available space at {{ storage_path }}: {{ available_space.stdout }}GB (Required: {{ min_space_gb }}GB)"

- name: Verify sufficient storage space
  fail:
    msg: "Insufficient storage space. Available: {{ available_space.stdout }}GB, Required: {{ min_space_gb }}GB"
  when: 
    - available_space.stdout is defined
    - available_space.stdout | int < min_space_gb | int
