# Mirror Configuration for WarehousePG - Remote Hosts Mode
# Generated by Ansible at {{ ansible_date_time.iso8601 }}
#
# Format: content_id|address|port|data_directory
# Mode: remote_hosts - mirrors on dedicated separate hosts
#       Requires whpg_mirror_segments group in inventory
#
{% set primary_segments_list = groups['whpg_primary_segments'] | default([]) %}
{% set mirror_segments_list = groups['whpg_mirror_segments'] | default([]) %}
{% set num_segments_per_host = whpg_data_directories | length %}
{% for segment_host_idx in range(primary_segments_list | length) %}
{%   set mirror_host = mirror_segments_list[segment_host_idx] %}
{%   set mirror_host_alias = hostvars[mirror_host].replication_alias | default(mirror_host) %}
{%   for seg_idx in range(num_segments_per_host) %}
{%     set content_id = (segment_host_idx * num_segments_per_host) + seg_idx %}
{%     set mirror_port = whpg_mirror_port_base + seg_idx %}
{%     set mirror_data_dir = whpg_mirror_data_directories[seg_idx] %}
{{ content_id }}|{{ mirror_host_alias }}|{{ mirror_port }}|{{ mirror_data_dir }}
{%   endfor %}
{% endfor %}
